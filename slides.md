---
title: "Tutorial on Static Analysis of Java with Moose"
highlightTheme: "github"
transition: "convex"
backgroundTransition: "convex"
logoImg: "https://www.etsmtl.ca/getmedia/4efcf5f0-b7ec-4429-a5d8-28fd4571039c/ETS-rouge-devise-ecran-fond_transparent"
slideNumber: true
controlsTutorial: false
separator: '^\r?\n---\r?\n$'
verticalSeparator: '^\r?\n--\r?\n$'
noteSeparator: '^Note:'
progress: true 

---


# Static Analysis of Java with Moose
Christopher FUHRMAN<br/>
Professor in Software and IT Engineering<br/>
École de technologie supérieure (ETS)

<span style="background-color:lightgreen">`tiny.cc/moose-tuto`</span> supporting [this blog entry](https://fuhrmanator.github.io/2019/07/29/AnalyzingJavaWithMoose.html).

---

# Technologies
 |
-------------|---------------
![](images/git.png){class=plain}{style="height:100px;"} | ![](images/octocat.png){class=plain}{style="height:100px;"}
![](images/pharo.png){class="plain"}{style="height:100px;"} | ![](images/moose-icon.png){class="plain"}{style="height:100px;"}

---

<!-- .slide: data-background-image="images/pharo.png" data-background-position="90% 10%" data-background-repeat="no-repeat" data-background-size="40% auto" data-background-opacity="0.8" -->

# Pharo

- Language (inspired by Smalltalk)
- Platform (immersive programming)
  - Image-based platform (like VirtualBox)
- Moose is a set of tools running in Pharo

<img src="images/moose-icon.png" class="plain reveal stretch">

---

## Overview

<img src="https://www.plantuml.com/plantuml/svg/JO_13e9034Jl_OeUyHVmeZ6QI20XCH8l71eekhfioUv2ebzlGGxUEfatayukHF9nx2t0SW6a1okECQE9SF3ov2Pk8LraaD4tZ8sqN4DQaWyh5mLxUZ6UziNvXhtw5fEA_SJ6SRRHV74vOcVidCk5sfMH3l-APqn4EulPhA4J_uAqCc4aQpxyoq1IMdBnMkHQEnD8Tp9Ets6liaToPD_110KVv4KfTkrIfGjbW9rAtVi5" class="reveal stretch plain">

Example from my blog <br/>[Analyzing Java with Moose 8](https://fuhrmanator.github.io/2019/07/29/AnalyzingJavaWithMoose.html)

---

# Preliminaries

Install the following for this tutorial

- `java` (command in path) JRE v. 8+
- `git` (command in path)

---

# Preliminaries Pharo

- [Install and run the Pharo Launcher](http://pharo.org/download).
- Copy `Moose-8` image from the Inria CI:
  **New Image Templates \> Official distributions \> Moose Suite 8.0 (development version) \> Create image**
- Launch the image once it has downloaded.

<img src="images/pharo-launcher.png" class="plain reveal stretch">

---

## Cloning a project from GitHub

<img src="https://www.plantuml.com/plantuml/svg/JP312i9034Jl-Og05_s5Ub54GR4WYCMBXzYckZRToEwse5zlMZruop1lXYIBc2YahXM0SGAOYBlTqrKwpbQYdd57FU4pw8FBDF-tHoDg5qh6KYk-G7QW47-9fDXImxXPvjipjkOBJWiEFJlFkzaSilounjh9aDihLJz6Q_mh7Z1Lwym7ymArXWQomiMEnBtvcu7fGSYdKxwtse50kf7pjWu7aosI9tb55msyKr2Zs5TZbLsjJrYOj1zy0000" class="reveal stretch plain">

--

## Cloning a project from GitHub

Clone using 

```bash
git clone ...
```

-or-

Clone with `MooseEasyUtility`.
In a Moose Playground (<kbd>CTRL</kbd>+<kbd>O</kbd>+<kbd>W</kbd>):

```smalltalk
javaProjectFileRef := MooseEasyUtility cloneGitHubRepo:
    'https://github.com/bethrobson/Head-First-Design-Patterns'.
```

---

## Creating a Moose Model (FAMIX)

<img src="https://www.plantuml.com/plantuml/svg/JP11Yy9038Nl-HM1lUXV62ykiWih3XHanKiFiKrrR3gHcMb1V_t6hWTlUUHxxv6iSw5Kna40vWd0RKGZuvOcmblIApTb1MwMMSVKC3RQSWqV4iwNSfAHNKKflnn5SQ2UyVlJ_nnnC59mSU0qSOYyNQxURNx_XLqGot8xfVP5QuTlPLRjLItTFvSrT9fwS8UGHvBmu7yFB2gXM7xzpWgU1DAPGWHNSJ8v84MIUmxPm0ibDOfZEqVPrNg3jKdxmHy0" class="reveal stretch plain">

--

## Creating a Moose Model (FAMIX)

We will parse Java source to a Moose Model using [VerveineJ](https://github.com/moosetechnology/VerveineJ).

1. Install VerveineJ in a Moose Playground as follows:

```smalltalk
verveineJFileRef := MooseEasyUtility cloneGitHubRepo:
    'https://github.com/moosetechnology/VerveineJ'.
```

> You can also install it by cloning the repo in a command line.

--

## Creating a Moose Model (FAMIX)

2. Start the `FamixMaker` tool in the menu **Moose > Moose Tools > Famix Maker** to produce a `tmp/HFDP.mse` Moose Model

<img src="images/FamixMakerDialog.png" class="plain reveal stretch">

---

## Loading model in Moose

<img src="https://www.plantuml.com/plantuml/svg/JP313W5138RlVOecBhp2k10X8IQH275ngDqkGtSgCxCIdbuj1xV-wVVtRpl9XLBfMW7eAm0t4usCAteGtfDUkIfZSBtCsgMAiTAQZ-0sbFAFAuejtHWNKxyyO6jzmU6UquD3vDN8_7uxnoQ8-GOIpfToaexTMgd-qThWNyJud_AgbkC_s14QJJTm-v0xal3Yhnk66w5OTdvjKHy2wKmXsegSJBP8aUIPGpRmGacDubZte-nglSF4fFtW3G00" class="reveal stretch plain">

--

## Loading model in Moose

In a Moose Playground, execute:

```smalltalk
"Load the moose Model with some error checking"
| mseFileRef mseStream mooseModel |
mseFileRef := 'tmp/HFDP.mse' asFileReference. "Generated by FamixMaker"
mseStream := mseFileRef readStream.
mseStream
	ifNotNil: [ 
		mooseModel := MooseModel importFromMSEStream: mseStream. 
		mooseModel rootFolder:
      'tmp/MooseEasyRepos/bethrobson__Head-First-Design-Patterns'.
		mooseModel install. "So it appears in the Panel"
		mseStream close. ]
	ifNil: [ self error: 
    'Could not load MSE file into Moose: ' , mseFileRef asString ].
```

---

## Visualizing the model (PlantUML)

<img src="https://www.plantuml.com/plantuml/svg/JO_12i9034Jl-Og0b_eBzQA8Wc914CMBXzYckZRTbDsje5zlMZruov0taymy9WgfRmLWd03ofQXdtDAJi0lwu3BD81zbr3wKZALMV85yJo7-kAJOKiEuNXIRCxQs5ynE79xiF6-dvYyEAwoT3BwTKlLZjCQ_u05JjSnYM5wWrj30HDpjdgxIStvoiITnR_ww8TiB-NGiTdPWO95kvBmzni5aY-H9Nj550-yKr2ZsrHXgNRM3kKbh_W40" class="reveal stretch plain">

--

## Visualizing the model (PlantUML)

- Click **Moose \> Moose Projects \> Load PlantUML Gizmo** to load the project.
- Invoke the GUI with the following command in a Moose Playground:

  ```smalltalk
  PUGizmoForMoose open.
  ```

--

## Visualizing the model (PlantUML)

The following browser should appear:

<img src="images/PlantUMLMooseOpen.png" class="plain reveal stretch">

--

## Visualizing the model (PlantUML)

See the [blog entry](https://fuhrmanator.github.io/2019/07/29/AnalyzingJavaWithMoose.html) for details.

---

## Analyzing the model

<img src="https://www.plantuml.com/plantuml/svg/JOz12i9034NtEKN0ZLvXt2YYe5WeYEB6HMnJ7KqdCZCLzFIcrOMxVFvx7p9BcMBkMW4OBW2t40sC6teIFgBUkCfJS4DCsiMAiTAQJ-1AYkd7PSMMxeohUR4-OckzuFZ0ySa-y6PYVh5ROkEbzxPAzO_H1l-6UqpLDek-F46ZyGxku5D7uj_yTM1S2eMyBxOssnD85_81Hk8lrtoMZbt9qOeMAP2yaa-cN2cgyHpgOTH-rGVCBDhd7m00" class="reveal stretch plain">

--

## Analyzing the model

There are some other ways to use Pharo to do analyses on a Java model. Benoît Verhaeghe has a [complementary blog entry](https://badetitou.github.io/misc/moose/pharo/2019/09/13/OOAnalysis/) to show such analyses.

Execute the following in a Moose Playground:

```smalltalk
Metacello new
    githubUser: 'badetitou' project: 'OOAnalysis' commitish: 'master' path: '.';
    baseline: 'OOAnalysis';
    load
```

--

## Analyzing the model

`<scripts >` in `OOAnalysis/OOCriticsVisu`:

<img src="images/OOAnalysisScripts.gif" class="plain reveal stretch">

--

## Analyzing the model

Write your own analyses in Pharo/Moose.

Learn more Pharo:
- [Pharo MOOC](http://mooc.pharo.org/)
- Pharo on [exercism.io](https://exercism.io/tracks/pharo-smalltalk)
- [Pharo By Example](https://books.pharo.org/updated-pharo-by-example/) book
- [MGL843 Sujets avancés en conception logicielle](https://sites.google.com/etsmtl.net/mgl843) (master's course at ÉTS)

--

## Analyzing the model

Write your own analyses in Pharo/Moose.

Learn more [Moose](https://moosetechnology.org/):
- [MooseQuery](https://moosequery.ferlicot.fr/devdocumentation.html) for advanced queries in Moose models
- [GitMiner](https://github.com/fuhrmanator/GitMiner) has a few classes to do static analysis

--

## Analyzing the model

Write your own analyses in Pharo/Moose.

Analyze other languages (experimental):
- C# - [roslyn2famix](https://github.com/feenkcom/roslyn2famix)
- C++ - [VerveineC-Cpp](https://github.com/jecisc/VerveineC-Cpp/) was started but not quite finished
- Fortran - [VerveineF](https://github.com/NicolasAnquetil/VerveineF)

---

# Feedback

Please leave me feedback at the bottom of the [blog entry](https://fuhrmanator.github.io/2019/07/29/AnalyzingJavaWithMoose.html), or via email: [Christopher.Fuhrman@etsmtl.ca](mailto:Christopher.Fuhrman@etsmtl.ca)